{% extends "plot_dose/base.html" %}
{% load crispy_forms_tags %}

{% block forms %}

    <div class="row">

        <div class="content-section col-md-8">
            <canvas id="myChart" width="400" height="400"></canvas>

            <script>

              window.addEventListener('load', setup);

              async function setup() {
                  const ctx = document.getElementById('myChart').getContext('2d');
                  const myChart = new Chart(ctx, {
                       type: 'scatter',
                       data: {
                           datasets: [
                               {% for key, value in data.items %}
                               {
                                   label: "{{ value.compound }}",
                                   data: [
                                       {% for item in value.coords %}
                                           {
                                               'x': new Date("{{ item.x.isoformat }}"),
                                               'y': {{ item.y }}
                                           },
                                       {% endfor %}
                                   ],
                                   fill: false,
                                   showLine: true,
                                   borderColor: "{{ value.color }}",
                                   backgroundColor: "{{ value.color }}",
                                   borderDash: {{ value.line }},
                                   borderWidth: 3,
                                   pointRadius: 0,
                               },
                               {% endfor %}
                           ],
                       },
                       options: {
                        responsive: true,
                        title: {
                            display: true,
                            text: 'Compound concentration'
                        },
                        scales: {
                            xAxes: [{
                                type: 'time',
                                display: true,
                                unit: 'second',
                                scaleLabel: {
                                    display: true,
                                    labelString: 'Time'
                                },
                                gridLines: {
                                    drawOnChartArea: false
                                },
                                ticks: {
                                    major: {
                                        fontStyle: 'bold',
                                        fontColor: '#FF0000'
                                    }
                                }
                            }],
                            yAxes: [{
                                display: true,
                                scaleLabel: {
                                    display: true,
                                    labelString: 'mol/L'
                                },
                                gridLines: {
                                    drawOnChartArea: false
                                },
                            }]
                        }
                    }
                    }
                  )
              }
            </script>
        </div>

        <div class="content-section col-md-4">
            <form action="/plot/dose_form/" method="post">
                {% csrf_token %}
                {{ plasma_conc|crispy }}
                <button type="submit" name="btnform3", class="btn btn-secondary btn-lg btn-block">Update Plot</button>
{#                <href class="btn btn-secondary btn-lg btn-block" href="{% url 'get_dose' %}" role="button">Add another dose</href>#}
            </form>
            <form action="/plot/dose_form/" method="get">
                <input type="submit" class="btn btn-secondary btn-lg btn-block" value="Add a Dose" name="add_dose">
            </form>
        </div>

    </div>


{% endblock forms %}